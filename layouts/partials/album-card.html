{{ $gallery := partial "get-gallery.html" . }}
{{ with $gallery }}
  <a class="card" href="{{ .page.RelPermalink }}" title="{{ .page.Title }}" data-index="{{ .Index }}">
    <img loading="lazy" style="background-color: {{ .color }}" alt="{{ .page.Title }}" class="gallery-thumbnail-{{ .page.Title }}" data-index="{{ .Index }}"/>
    <div>
      <h2>{{ .page.Title }}</h2>
      <p>
        {{ if gt .albumCount 0 }}
          {{ T "albumCount" (dict "count" (.albumCount | lang.FormatNumber 0) "photoCount" (.imageCount | lang.FormatNumber 0 | lang.Translate "photoCount")) }}
        {{ else }}
          {{ T "photoCount" (.imageCount | lang.FormatNumber 0) }}
        {{ end }}
      </p>
    </div>
  </a>
{{ end }}

<script>
  window.onload = function() {
    {{ with $gallery }}
      // Array of all image paths from Hugo
      const imagePaths_{{ .page.Title }} = [
        {{ range $index, $image := .thumbnail }}
          "{{ $image.RelPermalink }}", 
        {{ end }}
      ];
      const randomIndex_{{ .page.Title }} = Math.floor(Math.random() * imagePaths_{{ .page.Title }}.length);
      const featuredImage_{{ .page.Title }} = imagePaths_{{ .page.Title }}[randomIndex_{{ .page.Title }}];
      const thumbnail = document.querySelector('.gallery-thumbnail-{{ .page.Title }}');
      if (thumbnail_{{ .page.Title }}) {
        thumbnail_{{ .page.Title }}.src = featuredImage_{{ .page.Title }};
        thumbnail_{{ .page.Title }}.alt = "Featured Image";
        thumbnail_{{ .page.Title }}.width = featuredImage_{{ .page.Title }}.width;
        thumbnail_{{ .page.Title }}.height = featuredImage_{{ .page.Title }}.height;
      }
    {{ end }}
  };
</script>